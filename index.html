<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ãƒˆã‚¤ãƒ¬ç·åˆè©•ä¾¡ã‚·ã‚¹ãƒ†ãƒ </title>

<style>
body {
  font-family: sans-serif;
}

.toilet {
  border: 2px solid #888;
  padding: 15px;
  margin: 15px;
}

.best {
  border: 4px solid red;
  background: #fff0f0;
}

input[type="range"] {
  width: 220px;
}

.bar {
  width: 200px;
  height: 10px;
  background: #ddd;
  margin-bottom: 6px;
}

.bar-inner {
  height: 10px;
  background: green;
}
</style>
</head>

<body>
<h1>ãƒˆã‚¤ãƒ¬ä½¿ç”¨çŠ¶æ³ï¼ˆç·åˆè©•ä¾¡ï¼‰</h1>
<div id="area"></div>

<script>
// =====================
// ãƒ‡ãƒ¼ã‚¿
// =====================
const toilets = [
  { name:"A", using:false, time:0, paper:100 },
  { name:"B", using:false, time:0, paper:100 },
  { name:"C", using:false, time:0, paper:100 }
];

const area = document.getElementById("area");

// =====================
// è©•ä¾¡é–¢æ•°
// =====================

// ğŸ§» ç´™ã‚¹ã‚³ã‚¢ï¼ˆå¿ƒç†ãƒ¢ãƒ‡ãƒ«ï¼š30%ã‚’å¢ƒã«æ€¥è½ï¼‰
function paperScore(p) {
  const x = p / 100;

  const k = 12;        // æ€¥æ¿€ã•
  const center = 0.3;  // 30%ã§è©•ä¾¡ãŒæ€¥è½

  const logistic = 1 / (1 + Math.exp(-k * (x - center)));

  return 30 * logistic;
}

// ã«ãŠã„ãƒ¬ãƒ™ãƒ«ï¼ˆ0ã€œ1ï¼‰
function smellLevel(seconds) {
  const maxTime = 180; 
  const x = Math.min(seconds / maxTime, 1);
  return 1 - Math.pow(x, 2);
}

// ç·åˆè©•ä¾¡
function totalScore(t) {

  let score = 0;

  // â‘  ç©ºå¸­ï¼ˆæœ€é‡è¦ï¼‰
  if (!t.using) score += 50;

  // â‘¡ ç´™
  score += paperScore(t.paper);

  // ğŸš¨ ç´™5%æœªæº€ã¯å¼·åˆ¶å¤±æ ¼
  if (t.paper < 5) score = 0;

  // â‘¢ ã«ãŠã„
  const smell = smellLevel(t.time);
  score -= 20 * Math.pow(smell, 2);

  return Math.max(0, Math.round(score));
}

// =====================
// æç”»
// =====================
function render() {
  area.innerHTML = "";

  const scores = toilets.map(t => totalScore(t));
  const best = Math.max(...scores);

  toilets.forEach((t, i) => {
    const smell = smellLevel(t.time);
    const score = scores[i];

    const div = document.createElement("div");
    div.className = "toilet";
    if (score === best) div.classList.add("best");

    div.innerHTML = `
      <h2>ãƒˆã‚¤ãƒ¬ ${t.name}</h2>

      <p><b>${t.using ? "ä½¿ç”¨ä¸­" : "ç©ºå¸­"}</b></p>
      <button onclick="toggleUse(${i})">
        ${t.using ? "ç©ºå¸­ã«ã™ã‚‹" : "ä½¿ç”¨ä¸­ã«ã™ã‚‹"}
      </button>

      <p>æœ€çµ‚ä½¿ç”¨ã‹ã‚‰ã®çµŒéæ™‚é–“ï¼š${t.time} ç§’</p>

      <p>ã«ãŠã„ãƒ¬ãƒ™ãƒ«ï¼š${Math.round(smell * 100)}%</p>
      <div class="bar">
        <div class="bar-inner" style="width:${smell * 200}px"></div>
      </div>

      <p>ç´™æ®‹é‡ï¼š${t.paper}%</p>
      <input type="range" min="0" max="100" value="${t.paper}"
        oninput="updatePaperValue(${i}, this.value)"
        onchange="finalizePaper(${i}, this.value)">

      <p><b>ç·åˆè©•ä¾¡ï¼š${score} ç‚¹</b></p>
      <p>${"â˜…".repeat(Math.round(score / 20))}</p>
    `;

    area.appendChild(div);
  });
}

// =====================
// æ“ä½œ
// =====================
function updatePaperValue(i, value) {
  toilets[i].paper = Number(value);
}

function finalizePaper(i, value) {
  toilets[i].paper = Number(value);
  render();
}

function toggleUse(i) {
  toilets[i].using = !toilets[i].using;
  if (toilets[i].using) toilets[i].time = 0;
  render();
}

// =====================
// æ™‚é–“çµŒé
// =====================
setInterval(() => {
  toilets.forEach(t => {
    if (!t.using) t.time++;
  });
  render();
}, 1000);

// åˆæœŸè¡¨ç¤º
render();
</script>
</body>
</html>
